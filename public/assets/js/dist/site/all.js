$(document).ready((function(){var e=$("#main_content"),t=e.find(".center_content"),a=e.find(".shopping_cart"),o=a.find("#products_cart"),r=a.find(".price"),n=t.find(".btn-add-carrinho"),d=e.find(".btn-alterar-quantidade"),i=e.find(".btn-remover-produto");n.on("click",(function(e){e.preventDefault();var t=$(this).attr("data-id");$.ajax({url:"/carrinho/add/"+t,type:"POST",success:function(){$.ajax({url:"/carrinho/get",dataType:"json",success:function(e){numeral.language("pt-br"),o.html(e.numeroProdutosCarrinho),r.html(numeral(e.valorProdutosCarrinho).format("$0,0.00"))}})}})})),d.on("click",(function(e){e.preventDefault();var t=$(this).closest("tr").find(".input_quantidade").val(),a=$(this).attr("data-id");$.ajax({url:"/carrinho/update",data:"id="+a+"&qtd="+t,type:"POST",success:function(e){"semEstoque"==e&&(alert("Este produto não tem mais em estoque."),location.reload()),"updated"!=e&&"deleted"!=e||location.reload()}})})),i.on("click",(function(e){e.preventDefault();var t=$(this).attr("data-id");$.ajax({url:"/carrinho/remove",data:"id="+t,type:"POST",success:function(e){"deleted"==e&&location.reload()}})}))})),function(){var e=$("#main_content").find(".center_content"),t=e.find("#message"),a=e.find("#email_esqueci_senha");e.find("#btn-esqueci-senha").on("click",(function(e){e.preventDefault();var o=a.val();$.ajax({url:"/esqueci/send",data:"email="+o,type:"POST",beforeSend:function(){t.html("Recuperando dados, aguarde...")},success:function(e){"enviado"==e&&(t.html(""),alert("Enviado o email para redefinir a senha com sucesso!")),"user"!=e&&"erroValidate"!=e||(t.html(""),location.reload())}})}))}(),$(document).ready((function(){var e=$("#main_content").find(".center_content"),t=e.find("#btn-fechar-pedido"),a=e.find("#input-frete");t.on("click",(function(e){e.preventDefault(),$.ajax({url:"/checkout",dataType:"json",beforeSend:function(){$(t).text("Fechando pedido...")},success:function(e){"empty"==e&&($(t).text("Fechar Pedido"),alertDefault("warning","Carrinho Vazio","Você precisa ter algum produto no carrinho para fechar o pedido!")),"notLoggedIn"==e&&($(t).text("Fechar Pedido"),alertNotLoggedIn("Não está logado!","Você precisa estar logado para calcular o frete.")),"frete"==e&&($(t).text("Fechar Pedido"),alertDefault("warning","Erro de frete!","Você precisa calcular o frete para finalizar a compra."),$(a).focus()),"erroCadastro"==e&&($(t).text("Fechar Pedido"),alertDefault("warning","Erro ao cadastrar pedido!","Ocorreu um erro ao fechar seu pedido, tente novamente.")),"sim"==e.redirecionar&&(alertDefault("success","Pedido Fechado!","Em 5 segundos você será redirecionado para finalizar a sua compra."),setTimeout((function(){window.location.href=e.url}),5e3))}})}))})),$(document).ready((function(){var e=$("#main_content"),t=e.find("#btn-calcular-frete"),a=e.find("#input-frete"),o=e.find(".mensagem-frete");t.on("click",(function(e){e.preventDefault();var t=a.val();$.ajax({url:"/frete/calcular",type:"POST",data:"frete="+t,dataType:"json",beforeSend:function(){o.html("Calculando o frete...")},success:function(e){"login"==e&&(alertNotLoggedIn("Não está logado!","Você precisa estar logado para calcular o frete."),o.html("")),"produto"==e&&(alertDefault("warning","Você precisa ter produtos no carrinho para calcular o frete."),o.html("")),"sim"==e.erro&&(alertDefault("warning",e.mensagem),o.html("")),"nao"==e.erro&&location.reload()}})}))})),numeral.language("pt-br",{delimiters:{thousands:".",decimal:","},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){return"º"},currency:{symbol:"R$ "}}),$("#main_content").find(".btn-ver-pedido").on("click",(function(e){e.preventDefault();var t=$(this).attr("data-id");$.ajax({url:"/pedidos/show/"+t,type:"POST",dataType:"json",success:function(e){var t="<table class='ui very basic collapsing celled table'>";t+="<thead>",t+="<tr>",t+="<th></th>",t+="<th>Produto</th>",t+="<th>Valor</th>",t+="<th>Qtde</th>",t+="<th>Subtotal</th>",t+="</tr>",t+="</thead>",numeral.language("pt-br"),t+="<tbody>",$.each(e,(function(e,a){t+="<tr>",t+="<td><img src='"+a.produtos.produto_foto+"' width='30' height='30' /></td>",t+="<td>"+a.produtos.produto_nome+"</td>",t+="<td>"+numeral(a.valor).format("$0,0.00")+"</td>",t+="<td>"+a.qtd+"</td>",t+="<td>"+numeral(a.subtotal).format("$0,0.00")+"</td>",t+="</tr>"})),t+="</tbody>",t+="</table>",alertHTML("<h2>Meu Pedido</h2>",t,"ver-pedidos")}})}));